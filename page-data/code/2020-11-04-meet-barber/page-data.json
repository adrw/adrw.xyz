{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/code/2020-11-04-meet-barber","result":{"data":{"post":{"__typename":"MdxPost","slug":"/code/2020-11-04-meet-barber","title":"Meet BarberðŸ’ˆ: the best way to manage your Mustache","date":"2020-11-04","tags":[{"name":"Blog","slug":"blog"},{"name":"Code","slug":"code"},{"name":"Code(Cash App)","slug":"code-cash-app"}],"description":null,"canonicalUrl":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Meet BarberðŸ’ˆ: the best way to manage your Mustache\",\n  \"date\": \"2020-11-04T00:00:00.000Z\",\n  \"slug\": \"code/2020-11-04-meet-barber\",\n  \"tags\": [\"Blog\", \"Code\", \"Code(Cash App)\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", null, \"Written for \", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"https://cashapp.github.io/2020-11-04/meet-barber\"\n  }, \"Cash App Code Blog\")), mdx(\"p\", null, \"Cash App clients and services render thousands of English Mustache templates to send millions of personalized notifications, emails, text messages, and in-app UI daily to our customers.\"), mdx(\"p\", null, \"In the past 2 years, as more engineers have joined Cash App and localization has risen to be top of mind, improving the developer experience and localization capabilities for our notification stack motivated us to build Barber.\"), mdx(\"p\", null, \"Barber is a new Kotlin library for building up type-safe, localized, fillable documents using \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://mustache.github.io/\"\n  }, \"Mustache\"), \" templates.\"), mdx(\"p\", null, \"Barber is now battle tested. Cash App has used Barber to render and send over 1 billion notifications. With no material performance cost, Barber provides extensive additional capabilities on top of basic Mustache templates.\"), mdx(\"p\", null, \"Read more to find out why Barber is the best way to manage your Mustache.\"), mdx(\"h2\", null, \"Type Safe\"), mdx(\"p\", null, \"This is a Mustache template:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"\\\"{{ senderFirstName }}, you sent {{ amount }} to {{ recipient }} for {{ initiatorNote }}. \\\\n{{ promoBlock }}!\\\"\\n\")), mdx(\"p\", null, \"Mustache templates are untyped. This is flexible but not safe:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"What happens when a variable is missing or null?\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"What happens when a variable is unused?\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"What happens when a variable type is wrong?\")), mdx(\"p\", null, \"With plain Mustache templates, silent failures are the default. Failures would go undetected until a customer reports that their notification from Cash App looks wrong.\"), mdx(\"p\", null, \"Barber's type-safe Kotlin templates and validation catches errors at compile-time when engineers are writing code, not at runtime in front of customers.\"), mdx(\"h2\", null, \"Fillable Documents\"), mdx(\"p\", null, \"Documents are sometimes a single \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"{{ fillable }}\"), \" template string. Think of an SMS message template that only has a single body field.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-kotlin\"\n  }, \"val smsTemplate = \\\"Alice, you sent $50.00 to Bob Jones for \\uD83C\\uDF2F. \\\\nChoose a Boost on the Cash App!\\\"\\n\")), mdx(\"p\", null, \"But sometimes there are many templates that are always used together.\\nConsider below the many templates needed to render a personalized and themed email.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-kotlin\"\n  }, \"val subjectTemplate = \\\"Alice, you sent $50.00 to Bob Jones for \\uD83C\\uDF2F\\\"\\nval bodyHtmlTemplate = \\\"Alice, you sent $50.00 to Bob Jones for \\uD83C\\uDF2F. \\\\nChoose a Boost on the Cash App!\\\"\\nval primaryButtonTemplate = \\\"Cancel Payment\\\"\\nval themeTemplate = \\\"FLAT_GREEN\\\"\\nval plainTextTemplate = \\\"Alice, you sent $50.00 to Bob Jones for \\uD83C\\uDF2F. \\\\nChoose a Boost on the Cash App!\\\"\\n\")), mdx(\"p\", null, \"Plain Mustache templates each need to be manually passed around, managed, rendered, and then stitched together into a final document.\"), mdx(\"p\", null, \"Barber fillable Documents allow for a single data class to encapsulate, configure, and render all enclosed templates. Working with these in application code requires much less manual engineer coordination.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-kotlin\"\n  }, \"import app.cash.barber.models.Document\\n\\ndata class EmailDocument(\\n val email_subject: String,\\n val email_title: String,\\n val email_subtitle: String,\\n val email_code: String,\\n @BarberField(encoding = STRING_PLAINTEXT)\\n val email_plainText: String,\\n val email_previewText: String,\\n val email_buttonLabel: String,\\n val email_buttonUrl: String,\\n) : Document\\n\")), mdx(\"h2\", null, \"Localized\"), mdx(\"p\", null, \"Supporting multiple languages is hard. Adding the first language can be done by copy/pasting around the new translation. Scalable localization raises some questions:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"But how do we handle 2 or 3 or 10 languages?\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Could it be done in a way that minimizes boilerplate overhead to handle each additional translation?\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Could it have a pluggable fallback engine for when one language is requested but hasn\\u2019t yet been translated?\")), mdx(\"p\", null, \"Plain Mustache templates do not have any localization primitives, so managing and retrieving translations falls on the engineer or using a separate localization library.\"), mdx(\"p\", null, \"Barber lets you install templates for different languages and configure fallback logic for when a customer requests a language that is not yet translated.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-kotlin\"\n  }, \"val receiptBarber = barbershop.getBarber(RecipientReceipt::class)\\nval smsEN_US = receiptBarber.render(sandy50Receipt, EN_US)\\n// = Sandy Winchester sent you $50\\nval smsEN_CA = receiptBarber.render(sandy50Receipt, EN_CA)\\n// = Sandy Winchester sent you $50, eh?\\nval smsES_US = receiptBarber.render(sandy50Receipt, ES_US)\\n// = Sandy Winchester te envio $50\\n\")), mdx(\"h2\", null, \"Meet Barber\"), mdx(\"p\", null, \"Barber makes rendering localized documents as easy as passing in the personalizing data and a locale, then renders a type-safe, multi-field, localized document.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"56.25%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlElEQVQoz42T626DMAyFuXRAEkgpZSQEAmXl0lZqt1Xa+z/aWcKEumrdtB9HGBN9sY+N4zgOfN9HEARYrVYghMxyXRf223fRNEU2aNSjRtkWd2cyvsV1+rCxOUgp+r5H13UYxxHTNCGO4xvM/XryIkP7NqHuG2QFB03Ij0udB4m5Qlutjb9XETGCZMuhWoWIhvB8939AC1lAhFHIUaHsJJpBoBkFVCORyzXyco005/f2bDYbKKVQFAW01nNcVRXCKPwCxgzdtUd7fsHwusfpY4BoClNhAMaN33F0D2SMQUoJIcQMtbEF27YXoDrWEL2CHhSGS4Px0kHvS+NhiICs4Hru3y0nSXLz0PNuk8wyoy08zwclFLt2N+fshjwELqXbCS9Aq3SdIjUrY9fLvj8FT2BZjFIL1G2N9YabTgIzJO8GtK0fDod5fY7HwwyNzURz41ez13iWuRlAbCYdGP8I9Pse1blDd9pBjxLVi1gudPCb7GpELERIwrs84xTtqUZtPO3PGrItwbeJscL9G/ibHv1Fiz4Bq/z3ZcZaot8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"barber components\",\n    \"title\": \"barber components\",\n    \"src\": \"/static/f7c1fed0eaefdc7014a0b0c5da98cec7/7d769/barber-components.png\",\n    \"srcSet\": [\"/static/f7c1fed0eaefdc7014a0b0c5da98cec7/5243c/barber-components.png 240w\", \"/static/f7c1fed0eaefdc7014a0b0c5da98cec7/ab158/barber-components.png 480w\", \"/static/f7c1fed0eaefdc7014a0b0c5da98cec7/7d769/barber-components.png 960w\", \"/static/f7c1fed0eaefdc7014a0b0c5da98cec7/87339/barber-components.png 1440w\", \"/static/f7c1fed0eaefdc7014a0b0c5da98cec7/88b03/barber-components.png 1920w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-kotlin\"\n  }, \"val smsEN_US = receiptBarber.render(sandy50Receipt, EN_US)\\n// = SmsDocument(smsText = \\\"Sandy Winchester sent you $50\\\")\\n\")), mdx(\"p\", null, \"In June 2018, Barber launched on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/cashapp/barber\"\n  }, \"Github\"), \" with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://cashapp.github.io/barber/\"\n  }, \"documentation\"), \" and code examples.\"), mdx(\"p\", null, \"Billions of notifications later, Barber remains the reliable render and template organization engine for Cash App.\"), mdx(\"p\", null, \"Try it out for yourself and find out why Barber is the best way to manage your Mustache.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Written for  Cash App Code Blog Cash App clients and services render thousands of English Mustache templates to send millions ofâ€¦","timeToRead":2,"banner":null}},"pageContext":{"slug":"/code/2020-11-04-meet-barber","formatString":"YYYY-MM-DD"}},"staticQueryHashes":["318001574","3787687951","3787687951"]}